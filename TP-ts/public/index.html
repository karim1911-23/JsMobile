<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Reading Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold mb-6">Book Reading Tracker</h1>

    <!-- Form to add new book -->
    <form id="bookForm" class="grid grid-cols-2 gap-4 mb-8">
      <input type="text" name="title" placeholder="Title" class="p-2 border rounded" required>
      <input type="text" name="author" placeholder="Author" class="p-2 border rounded" required>
      <input type="number" name="pages" placeholder="Number of Pages" class="p-2 border rounded" required>
      <select name="status" class="p-2 border rounded" required>
        <option value="">Status</option>
        <option value="Read">Read</option>
        <option value="Re-read">Re-read</option>
        <option value="DNF">DNF</option>
        <option value="Currently reading">Currently reading</option>
        <option value="Returned Unread">Returned Unread</option>
        <option value="Want to read">Want to read</option>
      </select>
      <input type="number" name="price" placeholder="Price" class="p-2 border rounded" required>
      <input type="number" name="pagesRead" placeholder="Pages Read (default 0)" class="p-2 border rounded">
      <select name="format" class="p-2 border rounded" required>
        <option value="">Format</option>
        <option value="Print">Print</option>
        <option value="PDF">PDF</option>
        <option value="EBook">EBook</option>
        <option value="AudioBook">AudioBook</option>
      </select>
      <input type="text" name="suggestedBy" placeholder="Suggested By" class="p-2 border rounded" required>
      <button type="submit" class="col-span-2 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Add Book</button>
    </form>

    <!-- List of books -->
    <h2 class="text-2xl font-semibold mb-4">Your Books</h2>
    <div id="bookList" class="grid gap-4"></div>

    <!-- Global stats -->
    <h2 class="text-2xl font-semibold mt-8 mb-4">Global Stats</h2>
    <div id="globalStats" class="bg-gray-200 p-4 rounded"></div>
  </div>

  <script>
    const form = document.getElementById('bookForm');
    const bookList = document.getElementById('bookList');
    const globalStats = document.getElementById('globalStats');

    // Fetch and display books
    async function loadBooks() {
      const res = await fetch('/api/books');
      const books = await res.json();
      bookList.innerHTML = '';
      let totalBooksRead = 0;
      let totalPagesRead = 0;

      books.forEach(book => {
        totalPagesRead += book.pagesRead;
        if (book.finished) totalBooksRead++;

        const div = document.createElement('div');
        div.className = 'bg-gray-50 p-4 rounded shadow';
        div.innerHTML = `
          <h3 class="font-bold">${book.title} by ${book.author}</h3>
          <p>Pages: ${book.pagesRead}/${book.pages} (${book.percentage.toFixed(2)}%)</p>
          <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${book.percentage}%"></div>
          </div>
          <p>Status: ${book.status} | Format: ${book.format} | Price: $${book.price} | Suggested By: ${book.suggestedBy} | Finished: ${book.finished ? 'Yes' : 'No'}</p>
          <input type="number" id="pagesRead-${book._id}" value="${book.pagesRead}" class="p-1 border rounded w-24 mt-2" min="0" max="${book.pages}">
          <button onclick="updatePagesRead('${book._id}')" class="bg-green-500 text-white p-1 rounded ml-2">Update Progress</button>
          <button onclick="deleteBook('${book._id}')" class="bg-red-500 text-white p-1 rounded ml-2">Delete</button>
        `;
        bookList.appendChild(div);
      });

      globalStats.innerHTML = `
        <p>Total Books Read: ${totalBooksRead}</p>
        <p>Total Pages Read: ${totalPagesRead}</p>
      `;
    }

    // Add book
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);
      await fetch('/api/books', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      form.reset();
      loadBooks();
    });

    // Update pagesRead
    window.updatePagesRead = async (id) => {
      const pagesRead = document.getElementById(`pagesRead-${id}`).value;
      await fetch(`/api/books/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pagesRead: parseInt(pagesRead) })
      });
      loadBooks();
    };

    // Delete book
    window.deleteBook = async (id) => {
      await fetch(`/api/books/${id}`, { method: 'DELETE' });
      loadBooks();
    };

    // Initial load
    loadBooks();
  </script>
</body>
</html>